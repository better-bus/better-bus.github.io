import{$ as _,B as S,H as G,I as o,Ja as O,Ka as y,Q as I,Ra as F,W as k,X as M,Z as E,_ as f,a as h,aa as P,b as g,ba as l,ca as s,da as v,ka as x,kb as D,na as b,nb as j,pa as d,qa as C,qb as $,r as w,ra as u,tb as A,ub as W,va as T,vb as B,wa as N,xa as z,zb as H}from"./chunk-4LWO4URV.js";var J=(i,t)=>t.label,K=(i,t)=>t.id;function R(i,t){if(i&1&&(l(0,"option",5),d(1),s()),i&2){let n=t.$implicit,p=x();P("value",p.scheduleGroups().indexOf(n)),o(),C(n.label)}}function U(i,t){if(i&1&&(l(0,"span"),d(1),s(),v(2,"br")),i&2){let n=x().$implicit;o(),u(" ",n.nickname," ")}}function V(i,t){if(i&1&&(l(0,"span",17),d(1),s()),i&2){let n=t.$implicit,p=x().$implicit;b("gray",!p.hasSeat),o(),C(n)}}function q(i,t){if(i&1&&(l(0,"li",12)(1,"span",13)(2,"span"),d(3),l(4,"span",14),d(5),s()()(),l(6,"span",15),f(7,V,2,3,"span",16,E),s()()),i&2){let n=t.$implicit,p=x(3);o(2),b("bold",n.hasSeat)("italic",!n.hasSeat),o(),u(" ",n.displayName," "),o(2),u("(",n.grade||"?",")"),o(2),_(p.WEEKDAYS)}}function Q(i,t){if(i&1&&(l(0,"div",8)(1,"h3")(2,"span",9)(3,"strong"),d(4),s(),k(5,U,3,1),l(6,"span"),d(7),s()(),l(8,"span",10),v(9,"span",11),s()(),l(10,"ul"),f(11,q,9,6,"li",12,K),s()()),i&2){let n=t.$implicit;o(4),u("",n.id,":"),o(),M(n.nickname?5:-1),o(),b("deemphasize",n.nickname),o(),u(" ",n.address," "),o(2),P("innerHTML",n.timesFormatted,G),o(2),_(n.students)}}function X(i,t){i&1&&(l(0,"div",7),f(1,Q,13,6,"div",8,K),s()),i&2&&(o(),_(t.stops))}var L=class i{WEEKDAYS=["M","Tu","W","Th","F"];planService=w(D);plan=this.planService.currentPlan;schedules=S([]);scheduleGroups=O(()=>{let t=this.plan();return t?this.schedules().reduce((r,e)=>{console.log({prev:r,curr:e});let a=e.stops[0].stopType,c=r.find(m=>m.type===a);return c?c.schedules.push(e):r.push({type:a,schedules:[e]}),r},[]).map(r=>g(h({},r),{schedules:r.schedules.sort((e,a)=>a.days.length-e.days.length||e.name.localeCompare(a.name))})).map(r=>g(h({},r),{label:`${r.type} (${r.schedules.map(e=>e.name).join(", ")})`,stops:r.schedules[0].stops.map(e=>{let a=t.stops.find(c=>c.id===e.stopId);return a?g(h({},a),{times:r.schedules.map(c=>{let m=c.stops.find(Y=>Y.stopId===a.id).time;return new Date(`Jan 1 1970 ${m}`)}),students:t.roster.stopAssignments.filter(c=>c.stop.id===a.id).map(c=>g(h({},c.student),{hasSeat:!!t.seatAssignments.find(m=>m.studentId===c.student.id)})).sort((c,m)=>c.hasSeat&&!m.hasSeat?-1:m.hasSeat&&!c.hasSeat?1:(c.displayName??c.name).localeCompare(m.displayName??m.name))}):null}).filter(e=>!!e).sort((e,a)=>e.times[0].getTime()-a.times[0].getTime()).map(e=>g(h({},e),{timesFormatted:e.times.map(a=>F(a,"shortTime","en-US")).map(a=>`<span class="nowrap">${a}</span>`).join(" <wbr>/<wbr> ")}))})):[]});selectedGroupIdx=S(null);selectedGroup=O(()=>this.scheduleGroups()?.[this.selectedGroupIdx()??NaN]);constructor(){y(()=>{this.schedules.set(this.plan()?.schedules??[])}),y(()=>{let t=this.scheduleGroups();!this.selectedGroup()&&t.length&&this.selectedGroupIdx.set(0)}),y(()=>{let t=this.selectedGroup();console.log({selectedGroup:t})})}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=I({type:i,selectors:[["app-checklist-step"]],decls:17,vars:5,consts:[[1,"print-checklist"],[1,"checklist-header","screen-only"],[1,"plan-title"],["for","schedule-group"],["id","schedule-group",3,"ngModelChange","ngModel"],[3,"value"],[1,"checklist-header-print","print-only"],[1,"checklist-columns"],[1,"stop-block"],[1,"left"],[1,"right"],[1,"time",3,"innerHTML"],[1,"student-checklist-row"],[1,"student-name"],[1,"student-grade"],[1,"checkboxes-container"],[1,"checkbox-box",3,"gray"],[1,"checkbox-box"]],template:function(n,p){if(n&1&&(l(0,"div",0)(1,"div",1)(2,"h2",2),d(3,"Checklist Report"),s(),l(4,"label",3),d(5,"Select Schedule Group:"),s(),l(6,"select",4),z("ngModelChange",function(e){return N(p.selectedGroupIdx,e)||(p.selectedGroupIdx=e),e}),f(7,R,2,2,"option",5,J),s()(),l(9,"div",6)(10,"span"),d(11),s(),l(12,"span"),d(13),s(),l(14,"span"),d(15),s()(),k(16,X,3,0,"div",7),s()),n&2){let r,e,a;o(6),T("ngModel",p.selectedGroupIdx),o(),_(p.scheduleGroups()),o(4),C((r=p.plan())==null?null:r.name),o(2),u("Bus: ",((e=p.plan())==null||e.bus==null?null:e.bus.number)??""),o(2),C(p.selectedGroup().type),o(),M((a=p.selectedGroup())?16:-1,a)}},dependencies:[H,W,B,A,j,$],styles:[".student-grade[_ngcontent-%COMP%]{font-weight:400;font-style:normal;margin-left:.2em;font-size:.95em}.bold[_ngcontent-%COMP%]{font-weight:700}.italic[_ngcontent-%COMP%]{font-style:italic;color:#aaa}.time[_ngcontent-%COMP%]{color:var(--primary-color, #007bff)}.checklist-columns[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex-wrap:wrap;gap:2rem;width:100%}@media print{@page{size:letter landscape}.checklist-columns[_ngcontent-%COMP%]{display:block;columns:3;column-gap:.25in}.checklist-columns[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{break-inside:unset;margin-bottom:.6rem!important}}.stop-block[_ngcontent-%COMP%]{min-width:300px;max-width:100%;box-sizing:border-box}.stop-block[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:0!important}.stop-block[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{max-width:60%}.checklist-header[_ngcontent-%COMP%]{margin-bottom:.5rem;text-align:center;display:flex;flex-direction:column;align-items:center}h3[_ngcontent-%COMP%]{font-weight:400;display:flex;flex-direction:row;gap:.5rem;border-bottom:1px solid #ccc;margin-bottom:0!important}h3[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:last-child{flex:1;text-align:right}.deemphasize[_ngcontent-%COMP%]{font-style:italic;color:#aaa;font-size:15px}.checklist-header-print[_ngcontent-%COMP%]{width:100%;display:flex;font-size:24px!important;font-weight:700;margin-bottom:.5rem;margin-top:-.5rem;flex-direction:row;justify-content:space-between;box-sizing:border-box}.checklist-header-print[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{display:block}.student-checklist-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin:0;padding:0;min-height:1.1em;line-height:1.1}.student-name[_ngcontent-%COMP%]{margin:0;padding:0;font-size:inherit;line-height:1.1;vertical-align:middle}ul[_ngcontent-%COMP%]{padding-block:0!important;margin-block:.05rem!important;margin:0!important;padding:0!important}li[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}li[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{box-sizing:border-box}.checkboxes-container[_ngcontent-%COMP%]{display:flex;gap:.04em;justify-content:flex-end;min-width:5em;padding:0;margin:0;align-items:center}.checkbox-box[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:1rem;height:1rem;border:1px solid #222;border-radius:2px;font-size:7pt;font-weight:700;background:#fff;color:#222;margin-left:.02em;box-sizing:border-box;-webkit-print-color-adjust:economy;print-color-adjust:economy;padding:0}.checkbox-box.gray[_ngcontent-%COMP%]{border-color:#aaa;color:#aaa}"]})};export{L as ChecklistStepComponent};
